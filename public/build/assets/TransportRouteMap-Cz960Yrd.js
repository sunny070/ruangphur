import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as M,A as D,o as L,a as R,h as C,g as O,t as j,f as F}from"./app-DYJu_hh0.js";function G(n,e,t,o){function s(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(p){try{d(o.next(p))}catch(h){l(h)}}function f(p){try{d(o.throw(p))}catch(h){l(h)}}function d(p){p.done?r(p.value):s(p.value).then(c,f)}d((o=o.apply(n,[])).next())})}function K(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var N=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var o,s,r;if(Array.isArray(e)){if(o=e.length,o!=t.length)return!1;for(s=o;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),o=r.length,o!==Object.keys(t).length)return!1;for(s=o;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[s]))return!1;for(s=o;s--!==0;){var l=r[s];if(!n(e[l],t[l]))return!1}return!0}return e!==e&&t!==t},$=K(N);const P="__googleMapsScriptId";var k;(function(n){n[n.INITIALIZED=0]="INITIALIZED",n[n.LOADING=1]="LOADING",n[n.SUCCESS=2]="SUCCESS",n[n.FAILURE=3]="FAILURE"})(k||(k={}));class E{constructor({apiKey:e,authReferrerPolicy:t,channel:o,client:s,id:r=P,language:l,libraries:c=[],mapIds:f,nonce:d,region:p,retries:h=3,url:m="https://maps.googleapis.com/maps/api/js",version:w}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=o,this.client=s,this.id=r||P,this.language=l,this.libraries=c,this.mapIds=f,this.nonce=d,this.region=p,this.retries=h,this.url=m,this.version=w,E.instance){if(!$(this.options,E.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(E.instance.options)}`);return E.instance}E.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?k.FAILURE:this.done?k.SUCCESS:this.loading?k.LOADING:k.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(o=>{o?t(o.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}const o={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(o).forEach(r=>!o[r]&&delete o[r]),!((t=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||t===void 0)&&t.importLibrary||(r=>{let l,c,f,d="The Google Maps JavaScript API",p="google",h="importLibrary",m="__ib__",w=document,y=window;y=y[p]||(y[p]={});const b=y.maps||(y.maps={}),_=new Set,I=new URLSearchParams,i=()=>l||(l=new Promise((a,u)=>G(this,void 0,void 0,function*(){var g;yield c=w.createElement("script"),c.id=this.id,I.set("libraries",[..._]+"");for(f in r)I.set(f.replace(/[A-Z]/g,v=>"_"+v[0].toLowerCase()),r[f]);I.set("callback",p+".maps."+m),c.src=this.url+"?"+I,b[m]=a,c.onerror=()=>l=u(Error(d+" could not load.")),c.nonce=this.nonce||((g=w.querySelector("script[nonce]"))===null||g===void 0?void 0:g.nonce)||"",w.head.append(c)})));b[h]?console.warn(d+" only loads once. Ignoring:",r):b[h]=(a,...u)=>_.add(a)&&i().then(()=>b[h](a,...u))})(o);const s=this.libraries.map(r=>this.importLibrary(r));s.length||s.push(this.importLibrary("core")),Promise.all(s).then(()=>this.callback(),r=>{const l=new ErrorEvent("error",{error:r});this.loadErrorCallback(l)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const T={key:0,class:"text-red-500 text-sm mb-2"},x="AIzaSyAGK-HMMYfseKAJY356jUJLnz2ILC5bN_g",U={__name:"TransportRouteMap",props:{transport:Object},emits:["update:source-locality","update:destination-locality","update:distance","update:transport-cost","maps-loaded"],setup(n,{emit:e}){const t=n,o=e,s=M(null),r=M(null),l=M(null),c=M(null),f=M(null),d=M(null),p=async()=>{try{await new E({apiKey:x,libraries:["places","geometry"],version:"weekly"}).load(),r.value=new google.maps.DirectionsService,l.value=new google.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:5}}),console.log("Google Maps Initialized!"),o("maps-loaded")}catch(i){console.error("Google Maps failed to initialize:",i),d.value="Failed to load Google Maps"}};let h=null,m=null;const w=(i,a)=>{h&&h.setMap(null),m&&m.setMap(null),h=new google.maps.Marker({position:i,map:s.value,draggable:!0}),m=new google.maps.Marker({position:a,map:s.value,draggable:!0}),h.addListener("dragend",async u=>{const g=u.latLng,v=await y(g);o("update:source-locality",v),c.value=g,_()}),m.addListener("dragend",async u=>{const g=u.latLng,v=await y(g);o("update:destination-locality",v),f.value=g,_()})},y=i=>new Promise(a=>{new google.maps.Geocoder().geocode({location:i},(u,g)=>{g==="OK"&&u[0]&&a(u[0].formatted_address)})}),b=async i=>new Promise((a,u)=>{new google.maps.Geocoder().geocode({address:i},(v,S)=>{S==="OK"&&v.length>0?a(v[0].geometry.location):u(`Geocode failed for ${i}: ${S}`)})}),_=async()=>{if(!r.value||!c.value||!f.value){console.error("Directions service or coordinates not ready");return}try{console.log("Calculating Route...");const i=await r.value.route({origin:c.value,destination:f.value,travelMode:google.maps.TravelMode.DRIVING});l.value.setDirections(i),console.log("Route Response:",i);const a=i.routes[0].legs[0];w(a.start_location,a.end_location);const u=(a.distance.value/1e3).toFixed(2),g=80;o("update:distance",u),o("update:transport-cost",(u*g).toFixed(2)),i.routes.length>0?(l.value.setDirections(i),d.value=null):(console.error("No route found."),d.value="No route found.")}catch(i){console.error("Route calculation failed:",i),d.value="Route calculation failed."}},I=async()=>{var i,a;if(!((i=t.transport)!=null&&i.source_locality)||!((a=t.transport)!=null&&a.destination_locality)){console.warn("Missing source or destination locality.");return}try{console.log("Fetching Coordinates for:",t.transport.source_locality,t.transport.destination_locality),c.value=await b(t.transport.source_locality),f.value=await b(t.transport.destination_locality),console.log("Source Coordinates:",c.value),console.log("Destination Coordinates:",f.value),s.value||(s.value=new google.maps.Map(document.getElementById("map"),{center:c.value,zoom:12})),l.value.setMap(s.value),await _()}catch(u){console.error("Error updating map:",u),d.value="Failed to update map."}};return D(()=>t.transport,i=>{console.log("Transport Props Updated:",i),I()},{deep:!0,immediate:!0}),L(async()=>{await p(),I()}),(i,a)=>(R(),C("div",null,[a[0]||(a[0]=O("h2",{class:"text-lg font-semibold mb-2"},"Transport Route Map",-1)),d.value?(R(),C("div",T,j(d.value),1)):F("",!0),a[1]||(a[1]=O("div",{id:"map",class:"w-full h-96"},null,-1))]))}},q=A(U,[["__scopeId","data-v-f5713180"]]);export{q as T};
