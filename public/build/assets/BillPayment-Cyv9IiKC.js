import{Q as z,d as X,u as P,w as Z}from"./dayjs.min-CDcnCoQa.js";import{r as T,e as F,o as p,a as g,f as O,g as o,h as j,t as d,d as I,b as t,j as r,n as D,Q as i,k as m,l as ee,c as L,F as te,i as se,m as le,v as ne,B as re,N as q}from"./app-Dfx8wdb3.js";import{Q as B,a as E}from"./format-DmVDsBgE.js";import{Q as oe}from"./QLayout-DG6G-lQ6.js";import{Q as de}from"./QMenu-CDTgN4HV.js";import{Q as ue}from"./QPage-7_3KjJyu.js";import{_ as ce}from"./AdminLayout-CKiilQGn.js";import"./QExpansionItem-CN0lkqWd.js";import"./ClosePopup-CHpksyTA.js";const ae={class:"q-my-md grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"flex flex-col sm:flex-row gap-2"},me={class:"flex justify-end"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={key:0,class:"flex"},be={class:"flex justify-end pr-16"},he={ref:"printSection",class:"rounded-lg overflow-x-auto table-responsive"},Ae={class:"q-table q-table__grid q-mb-lg"},ge={key:0},xe=["value"],ye={class:"no-print"},De=Object.assign({layout:ce},{__name:"BillPayment",props:{applications:Array,flash:Object},setup(C){const Q=C;T(null);const R=T([]),a=T(""),x=T("All"),u=T([]),U=F(()=>u.value.length>0),V=n=>X(n).format("dddd, MMMM D, YYYY h:mm A");p(()=>{const n=[...new Set(Q.applications.map(s=>s.deceased.district.name))];R.value=n.map(s=>({label:s,value:s}))});const w=F(()=>{let n=Q.applications;return x.value!=="All"&&(n=n.filter(s=>s.status===x.value)),a.value&&(n=n.filter(s=>{var e,c,l,f,v,b,h,A;return((e=s.application_no)==null?void 0:e.toString().includes(a.value))||((l=(c=s.deceased)==null?void 0:c.name)==null?void 0:l.toLowerCase().includes(a.value.toLowerCase()))||((v=(f=s.applicant)==null?void 0:f.name)==null?void 0:v.toLowerCase().includes(a.value.toLowerCase()))||((A=(h=(b=s.deceased)==null?void 0:b.district)==null?void 0:h.name)==null?void 0:A.toLowerCase().includes(a.value.toLowerCase()))})),n}),M=n=>{x.value=n},$=n=>{q.get(route("bill.show",n))},H=n=>{console.log("Delete application:",n)},K=()=>{u.value.length===w.value.length?u.value=[]:u.value=w.value.map(n=>n.id)},Y=async()=>{if(u.value.length>0)try{await q.post("/admin/bill/paymet-all",{ids:u.value},{onSuccess:()=>{u.value=[]}})}catch(n){console.error("Error processing payments:",n)}},W=async()=>{if(u.value.length>0)try{await q.post("/admin/bill/reject-all",{ids:u.value},{onSuccess:()=>{u.value=[]}})}catch(n){console.error("Error rejecting applications:",n)}},G=()=>{const s=document.querySelector(".q-table").cloneNode(!0);s.querySelectorAll(".no-print").forEach(l=>l.remove());const c=window.open("","","width=800,height=600");c.document.write(`
        <html>
            <head>
                <title>Print Table</title>
                <style>
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        padding: 8px 12px;
                        text-align: left;
                        border-bottom: 1px solid #ddd;
                    }
                    th {
                        background-color: #3A424A;
                        color: white;
                        font-weight: bold;
                    }
                </style>
            </head>
            <body>
                ${s.outerHTML}
            </body>
        </html>
    `),c.document.close(),c.print()},J=()=>{const n=w.value.map(l=>{var f,v,b,h,A,k,_,S,N,y;return{"Applicant NO.":l==null?void 0:l.application_no,"APPLICANT NAME.":(f=l==null?void 0:l.applicant)==null?void 0:f.name,"ADDRESS.":(v=l==null?void 0:l.applicant)==null?void 0:v.locality,"CONTACT No.":(b=l==null?void 0:l.applicant)==null?void 0:b.mobile,"MITTHI KHUA":(A=(h=l==null?void 0:l.deceased)==null?void 0:h.district)==null?void 0:A.name,"PLACE OF DEATH.":(k=l==null?void 0:l.deceased)==null?void 0:k.place_of_death," KILOMETER.":(_=l==null?void 0:l.transport)==null?void 0:_.distance,"AMOUNT CLAIMED":(S=l==null?void 0:l.transport)==null?void 0:S.transport_cost,"ACCOUNT No. OF CLAIMANT":(N=l==null?void 0:l.applicant)==null?void 0:N.account_no,IFSC:(y=l==null?void 0:l.applicant)==null?void 0:y.ifsc_code," Status":l==null?void 0:l.status,"Date Created":l==null?void 0:l.created_at,Signature:""}}),s=P.json_to_sheet(n),e=P.book_new();P.book_append_sheet(e,s,"Applications");const c=new Date().toISOString().slice(0,10);Z(e,`Applications_${c}.xlsx`)};return(n,s)=>(g(),O(ue,{padding:""},{default:o(()=>[C.flash.success?(g(),O(z,{key:0,class:"bg-green-4 text-white",dense:""},{default:o(()=>[j(d(C.flash.success),1)]),_:1})):I("",!0),C.flash.error?(g(),O(z,{key:1,class:"bg-red-4 text-white",dense:""},{default:o(()=>[j(d(C.flash.error),1)]),_:1})):I("",!0),t("div",ae,[t("div",ie,[r(i,{size:"",label:"Bill Pek tur",flat:"",class:D(x.value==="Approved"?"active-button":"inactive-button"),onClick:s[0]||(s[0]=e=>M("Approved"))},null,8,["class"]),r(i,{label:"Deposit to Bank",flat:"",class:D(x.value==="Processed"?"active-button":"inactive-button"),onClick:s[1]||(s[1]=e=>M("Processed"))},null,8,["class"]),r(i,{label:"Rejected",flat:"",class:D(x.value==="Rejected"?"active-button":"inactive-button"),onClick:s[2]||(s[2]=e=>M("Rejected"))},null,8,["class"])]),t("div",me,[r(ee,{rounded:"2lg",outlined:"",dense:"","bottom-slots":"",modelValue:a.value,"onUpdate:modelValue":s[4]||(s[4]=e=>a.value=e),label:"Search",class:"w-full max-w-md"},{append:o(()=>[a.value!==""?(g(),O(m,{key:0,name:"close",onClick:s[3]||(s[3]=e=>a.value=""),class:"cursor-pointer"})):I("",!0),r(m,{name:"search"})]),_:1},8,["modelValue"])])]),s[15]||(s[15]=t("hr",{class:"my-4 border-border bg-[#F0F0F0]"},null,-1)),t("div",fe,[t("div",null,[U.value?(g(),L("div",ve,[r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:K},{default:o(()=>[r(m,{name:"check",size:"16px",class:"q-mr-xs"}),s[6]||(s[6]=t("span",null,"Select All",-1))]),_:1}),r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:Y,disabled:!u.value.length},{default:o(()=>[r(m,{name:"check_circle",size:"16px",class:"q-mr-xs"}),s[7]||(s[7]=t("span",null,"Process for Deposit",-1))]),_:1},8,["disabled"]),r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:W,disabled:!u.value.length},{default:o(()=>[r(m,{name:"cancel",size:"16px",class:"q-mr-xs"}),s[8]||(s[8]=t("span",null,"Reject",-1))]),_:1},8,["disabled"])])):I("",!0)]),t("div",be,[r(i,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","flex-shrink":"0","border-radius":"8px",background:"transparent"},onClick:G},{default:o(()=>[r(m,{name:"print",size:"16px",class:"q-mr-xs"}),s[9]||(s[9]=t("span",null,"Print",-1))]),_:1}),r(i,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","flex-shrink":"0","border-radius":"8px",background:"transparent"},onClick:J},{default:o(()=>[r(m,{name:"ios_share",size:"16px",class:"q-mr-xs"}),s[10]||(s[10]=t("span",null,"Export",-1))]),_:1})])]),t("div",he,[t("table",Ae,[s[14]||(s[14]=t("thead",{class:"bg-[#3A424A] text-white font-bold h-[30px] w-full text-[11px]"},[t("tr",{class:"bg-[#3A424A] text-white"},[t("th"),t("th",null,"Sl.No."),t("th",null,"APPLICATION NO."),t("th",null,"APPLICANT NAME"),t("th",null,"ADDRESS"),t("th",null,"CONTACT No."),t("th",null,"MITTHI KHUA"),t("th",null,"PLACE OF DEATH"),t("th",null,"KILOMETER"),t("th",null,"AMOUNT CLAIMED"),t("th",null,"ACCOUNT No. OF CLAIMANT"),t("th",null,"IFSC"),t("th",null,"STATUS"),t("th",null,"DIL NI"),t("th",{class:"no-print"},"ACTIONS"),t("th",{class:"print-only"},"Signature")])],-1)),w.value.length?(g(),L("tbody",ge,[(g(!0),L(te,null,se(w.value,(e,c)=>{var l,f,v,b,h,A,k,_,S,N;return g(),L("tr",{key:e.id},[t("td",null,[le(t("input",{class:"no-print",type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=y=>u.value=y),value:e.id},null,8,xe),[[ne,u.value]])]),t("td",null,d(c+1),1),t("td",null,d(e==null?void 0:e.application_no),1),t("td",null,d((l=e==null?void 0:e.applicant)==null?void 0:l.name),1),t("td",null,d((f=e==null?void 0:e.applicant)==null?void 0:f.locality),1),t("td",null,d((v=e==null?void 0:e.applicant)==null?void 0:v.mobile),1),t("td",null,d((h=(b=e==null?void 0:e.deceased)==null?void 0:b.district)==null?void 0:h.name),1),t("td",null,d((A=e==null?void 0:e.deceased)==null?void 0:A.place_of_death),1),t("td",null,d((k=e==null?void 0:e.transport)==null?void 0:k.distance),1),t("td",null,d((_=e==null?void 0:e.transport)==null?void 0:_.transport_cost),1),t("td",null,d((S=e==null?void 0:e.applicant)==null?void 0:S.account_no),1),t("td",null,d((N=e==null?void 0:e.applicant)==null?void 0:N.ifsc_code),1),t("td",null,[t("div",{class:D([{"status-incoming":(e==null?void 0:e.status)==="Pending","status-rejected":(e==null?void 0:e.status)==="Rejected","status-approved":(e==null?void 0:e.status)==="Approved","status-paid":(e==null?void 0:e.status)==="Processed"},"status-badge"])},d(e==null?void 0:e.status),3)]),t("td",null,d(V(e==null?void 0:e.created_at)),1),t("td",ye,[r(i,{flat:"",icon:"more_vert",style:re(n.buttonStyle)},null,8,["style"]),r(de,null,{default:o(()=>[r(oe,null,{default:o(()=>[r(B,{clickable:"",class:"action-btn",onClick:y=>$(e.id)},{default:o(()=>[r(E,{avatar:""},{default:o(()=>[r(m,{size:"sm",name:"visibility"})]),_:1}),r(E,null,{default:o(()=>s[11]||(s[11]=[j("View")])),_:1})]),_:2},1032,["onClick"]),r(B,{clickable:"",class:"action-btn",onClick:y=>H(e.id)},{default:o(()=>[r(E,{avatar:""},{default:o(()=>[r(m,{name:"delete"})]),_:1}),r(E,null,{default:o(()=>s[12]||(s[12]=[j("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),s[13]||(s[13]=t("td",{class:"print-only"},null,-1))])}),128))])):I("",!0)])],512)]),_:1}))}});export{De as default};
