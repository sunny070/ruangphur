import{Q as z,d as Z,u as M,w as p}from"./dayjs.min-Ca2VIOYU.js";import{r as T,c as B,e as ee,o as A,a as O,b as o,f as I,t as d,d as E,g as s,j as r,n as j,Q as i,k as x,l as te,h as D,F as se,i as le,m as ne,v as re,p as oe,N as P}from"./app-a35SYv1t.js";import{Q as q,a as Q}from"./format-CnVq-veo.js";import{Q as de}from"./QLayout-0vXNl2tw.js";import{Q as ue}from"./QMenu-CHrEPOzK.js";import{Q as ce}from"./QPage-BiOgDWdw.js";import{_ as ae}from"./AdminLayout-DV-xXAjk.js";import"./QExpansionItem-B2zjQDuI.js";import"./ClosePopup-DfIh2mt8.js";const ie={class:"q-my-md grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"flex flex-col sm:flex-row gap-2"},fe={class:"flex justify-end"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={key:0,class:"flex"},he={class:"flex justify-end pr-16"},Ae={ref:"printSection",class:"table-responsive"},ge={class:"q-table q-table__grid q-mb-lg"},xe={key:0},ye=["value"],Ce={class:"no-print"},De=Object.assign({layout:ae},{__name:"BillPayment",props:{applications:Array,flash:Object},setup(C){const F=C;T(null);const U=T([]),a=T(""),y=T("All"),u=T([]),$=B(()=>u.value.length>0),R=n=>Z(n).format("dddd, MMMM D, YYYY h:mm A");ee(()=>{const n=[...new Set(F.applications.map(t=>t.deceased.district.name))];U.value=n.map(t=>({label:t,value:t}))});const k=B(()=>{let n=F.applications;return y.value!=="All"&&(n=n.filter(t=>t.status===y.value)),a.value&&(n=n.filter(t=>{var e,c,l,m,f,v,b,h;return((e=t.application_no)==null?void 0:e.toString().includes(a.value))||((l=(c=t.deceased)==null?void 0:c.name)==null?void 0:l.toLowerCase().includes(a.value.toLowerCase()))||((f=(m=t.applicant)==null?void 0:m.name)==null?void 0:f.toLowerCase().includes(a.value.toLowerCase()))||((h=(b=(v=t.deceased)==null?void 0:v.district)==null?void 0:b.name)==null?void 0:h.toLowerCase().includes(a.value.toLowerCase()))})),n}),L=n=>{y.value=n},V=n=>{P.get(route("bill.show",n))},H=n=>{console.log("Edit application:",n)},K=n=>{console.log("Delete application:",n)},Y=()=>{u.value.length===k.value.length?u.value=[]:u.value=k.value.map(n=>n.id)},W=async()=>{if(u.value.length>0)try{await P.post("/admin/bill/paymet-all",{ids:u.value},{onSuccess:()=>{u.value=[]}})}catch(n){console.error("Error processing payments:",n)}},G=async()=>{if(u.value.length>0)try{await P.post("/admin/bill/reject-all",{ids:u.value},{onSuccess:()=>{u.value=[]}})}catch(n){console.error("Error rejecting applications:",n)}},J=()=>{const t=document.querySelector(".q-table").cloneNode(!0);t.querySelectorAll(".no-print").forEach(l=>l.remove());const c=window.open("","","width=800,height=600");c.document.write(`
        <html>
            <head>
                <title>Print Table</title>
                <style>
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        padding: 8px 12px;
                        text-align: left;
                        border-bottom: 1px solid #ddd;
                    }
                    th {
                        background-color: #3A424A;
                        color: white;
                        font-weight: bold;
                    }
                </style>
            </head>
            <body>
                ${t.outerHTML}
            </body>
        </html>
    `),c.document.close(),c.print()},X=()=>{const n=k.value.map(l=>{var m,f,v,b,h,w,_,S,N,g;return{"Applicant NO.":l==null?void 0:l.application_no,"APPLICANT NAME.":(m=l==null?void 0:l.applicant)==null?void 0:m.name,"ADDRESS.":(f=l==null?void 0:l.applicant)==null?void 0:f.locality,"CONTACT No.":(v=l==null?void 0:l.applicant)==null?void 0:v.mobile,"MITTHI KHUA":(h=(b=l==null?void 0:l.deceased)==null?void 0:b.district)==null?void 0:h.name,"PLACE OF DEATH.":(w=l==null?void 0:l.deceased)==null?void 0:w.place_of_death," KILOMETER.":(_=l==null?void 0:l.transport)==null?void 0:_.distance,"AMOUNT CLAIMED":(S=l==null?void 0:l.transport)==null?void 0:S.transport_cost,"ACCOUNT No. OF CLAIMANT":(N=l==null?void 0:l.applicant)==null?void 0:N.account_no,IFSC:(g=l==null?void 0:l.applicant)==null?void 0:g.ifsc_code," Status":l==null?void 0:l.status,"Date Created":l==null?void 0:l.created_at,Signature:""}}),t=M.json_to_sheet(n),e=M.book_new();M.book_append_sheet(e,t,"Applications");const c=new Date().toISOString().slice(0,10);p(e,`Applications_${c}.xlsx`)};return(n,t)=>(A(),O(ce,{padding:""},{default:o(()=>[C.flash.success?(A(),O(z,{key:0,class:"bg-green-4 text-white",dense:""},{default:o(()=>[I(d(C.flash.success),1)]),_:1})):E("",!0),C.flash.error?(A(),O(z,{key:1,class:"bg-red-4 text-white",dense:""},{default:o(()=>[I(d(C.flash.error),1)]),_:1})):E("",!0),s("div",ie,[s("div",me,[r(i,{size:"",label:"Bill Pek tur",flat:"",class:j(y.value==="Approved"?"active-button":"inactive-button"),onClick:t[0]||(t[0]=e=>L("Approved"))},null,8,["class"]),r(i,{label:"Deposit to Bank",flat:"",class:j(y.value==="Processed"?"active-button":"inactive-button"),onClick:t[1]||(t[1]=e=>L("Processed"))},null,8,["class"]),r(i,{label:"Rejected",flat:"",class:j(y.value==="Rejected"?"active-button":"inactive-button"),onClick:t[2]||(t[2]=e=>L("Rejected"))},null,8,["class"])]),s("div",fe,[r(te,{rounded:"2lg",outlined:"",dense:"","bottom-slots":"",modelValue:a.value,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value=e),label:"Search",class:"w-full max-w-md"},{append:o(()=>[a.value!==""?(A(),O(x,{key:0,name:"close",onClick:t[3]||(t[3]=e=>a.value=""),class:"cursor-pointer"})):E("",!0),r(x,{name:"search"})]),_:1},8,["modelValue"])])]),t[16]||(t[16]=s("hr",{class:"my-4 border-border bg-[#F0F0F0]"},null,-1)),s("div",ve,[s("div",null,[$.value?(A(),D("div",be,[r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:Y},{default:o(()=>[r(x,{name:"check",size:"16px",class:"q-mr-xs"}),t[6]||(t[6]=s("span",null,"Select All",-1))]),_:1}),r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:W,disabled:!u.value.length},{default:o(()=>[r(x,{name:"check_circle",size:"16px",class:"q-mr-xs"}),t[7]||(t[7]=s("span",null,"Process for Deposit",-1))]),_:1},8,["disabled"]),r(i,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:G,disabled:!u.value.length},{default:o(()=>[r(x,{name:"cancel",size:"16px",class:"q-mr-xs"}),t[8]||(t[8]=s("span",null,"Reject",-1))]),_:1},8,["disabled"])])):E("",!0)]),s("div",he,[r(i,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","flex-shrink":"0","border-radius":"8px",background:"transparent"},onClick:J},{default:o(()=>[r(x,{name:"print",size:"16px",class:"q-mr-xs"}),t[9]||(t[9]=s("span",null,"Print",-1))]),_:1}),r(i,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","flex-shrink":"0","border-radius":"8px",background:"transparent"},onClick:X},{default:o(()=>[r(x,{name:"ios_share",size:"16px",class:"q-mr-xs"}),t[10]||(t[10]=s("span",null,"Export",-1))]),_:1})])]),s("div",Ae,[s("table",ge,[t[15]||(t[15]=s("thead",{class:"bg-[#3A424A] text-white font-bold h-[30px] w-full text-[11px]"},[s("tr",{class:"bg-[#3A424A] text-white"},[s("th"),s("th",null,"Sl.No."),s("th",null,"APPLICATION NO."),s("th",null,"APPLICANT NAME"),s("th",null,"ADDRESS"),s("th",null,"CONTACT No."),s("th",null,"MITTHI KHUA"),s("th",null,"PLACE OF DEATH"),s("th",null,"KILOMETER"),s("th",null,"AMOUNT CLAIMED"),s("th",null,"ACCOUNT No. OF CLAIMANT"),s("th",null,"IFSC"),s("th",null,"STATUS"),s("th",null,"DIL NI"),s("th",{class:"no-print"},"ACTIONS"),s("th",{class:"print-only"},"Signature")])],-1)),k.value.length?(A(),D("tbody",xe,[(A(!0),D(se,null,le(k.value,(e,c)=>{var l,m,f,v,b,h,w,_,S,N;return A(),D("tr",{key:e.id},[s("td",null,[ne(s("input",{class:"no-print",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=g=>u.value=g),value:e.id},null,8,ye),[[re,u.value]])]),s("td",null,d(c+1),1),s("td",null,d(e==null?void 0:e.application_no),1),s("td",null,d((l=e==null?void 0:e.applicant)==null?void 0:l.name),1),s("td",null,d((m=e==null?void 0:e.applicant)==null?void 0:m.locality),1),s("td",null,d((f=e==null?void 0:e.applicant)==null?void 0:f.mobile),1),s("td",null,d((b=(v=e==null?void 0:e.deceased)==null?void 0:v.district)==null?void 0:b.name),1),s("td",null,d((h=e==null?void 0:e.deceased)==null?void 0:h.place_of_death),1),s("td",null,d((w=e==null?void 0:e.transport)==null?void 0:w.distance),1),s("td",null,d((_=e==null?void 0:e.transport)==null?void 0:_.transport_cost),1),s("td",null,d((S=e==null?void 0:e.applicant)==null?void 0:S.account_no),1),s("td",null,d((N=e==null?void 0:e.applicant)==null?void 0:N.ifsc_code),1),s("td",null,[s("div",{class:j([{"status-incoming":(e==null?void 0:e.status)==="Pending","status-rejected":(e==null?void 0:e.status)==="Rejected","status-approved":(e==null?void 0:e.status)==="Approved","status-paid":(e==null?void 0:e.status)==="Processed"},"status-badge"])},d(e==null?void 0:e.status),3)]),s("td",null,d(R(e==null?void 0:e.created_at)),1),s("td",Ce,[r(i,{flat:"",icon:"more_vert",style:oe(n.buttonStyle)},null,8,["style"]),r(ue,null,{default:o(()=>[r(de,null,{default:o(()=>[r(q,{clickable:"",class:"action-btn",onClick:g=>V(e.id)},{default:o(()=>[r(Q,null,{default:o(()=>t[11]||(t[11]=[I("View")])),_:1})]),_:2},1032,["onClick"]),r(q,{class:"action-btn",onClick:g=>H(e.id)},{default:o(()=>[r(Q,null,{default:o(()=>t[12]||(t[12]=[I("Edit/Update")])),_:1})]),_:2},1032,["onClick"]),r(q,{class:"action-btn",onClick:g=>K(e.id)},{default:o(()=>[r(Q,null,{default:o(()=>t[13]||(t[13]=[I("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),t[14]||(t[14]=s("td",{class:"print-only"},null,-1))])}),128))])):E("",!0)])],512)]),_:1}))}});export{De as default};
