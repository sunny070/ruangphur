import{Q as K,u as $,w as ce,d as ve}from"./dayjs.min-Dw2SQPBT.js";import{r as b,c as z,o as be,a as u,b as y,w as o,d as N,t as m,e as f,f as a,g,h as Y,F as J,i as t,n as k,Q as r,j as x,k as d,l as fe,m as ge,p as xe,q as Ve,s as G,u as pe,N as T,v as he}from"./app-Cg05E-M0.js";import{Q as A}from"./QSelect-C2C0-NM-.js";import{Q as _,a as C}from"./format-PnhPivZU.js";import{Q as ye}from"./QLayout-Dx2kdi13.js";import{Q as ke}from"./QMenu-Dlx7_XBC.js";import{Q as Ae}from"./QForm-Dzb_p1Wd.js";import{Q as Ce}from"./QPage-B55A1LJH.js";import{C as we}from"./ClosePopup-BoeLJsVb.js";import{_ as qe}from"./AdminLayout-D62LqS4E.js";import"./QChip-Cosd9F7v.js";import"./rtl-DFPa-2ov.js";import"./QExpansionItem-CApeFePy.js";const Ue={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"},Se={class:"text-sm sm:text-base font-bold"},Fe={class:"text-xs sm:text-sm"},De={class:"q-my-md grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={class:"flex flex-col sm:flex-row gap-2"},je={class:"flex justify-end"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne={class:""},Te={key:0,class:"flex flex-col sm:flex-row gap-2"},Ee={class:"flex justify-end pr-16"},Pe={ref:"printSection",class:"overflow-x-auto table-responsive"},Me={class:"q-table q-table__grid w-full"},Re={key:0},Oe=["value"],$e={key:1},ze={key:0},_e={key:1},Le={key:2},nl=Object.assign({layout:qe},{__name:"Application",props:{applications:Array,statusCounts:Object,flash:Object,dropdowns:Object},setup(v){const V=v,W=n=>ve(n).format("dddd, MMMM D, YYYY h:mm A"),E=b(!1),c=b(1),s=b({deceased:{},transport:{},applicant:{}}),X=n=>{s.value=JSON.parse(JSON.stringify(n)),c.value=1,E.value=!0},Z=()=>{T.put(`/application/${s.value.id}`,s.value,{onSuccess:()=>{E.value=!1}})},ee=()=>{c.value<4&&c.value++},le=()=>{c.value>1&&c.value--},L=b([]),P=b(null),B=b([]),h=b(""),p=b("All"),i=b([]),te=z(()=>i.value.length>0),H=b(!1),se=()=>{i.value.length===w.value.length?(i.value=[],H.value=!1):(i.value=w.value.map(n=>n.id),H.value=!0)},ae=()=>{P.value?L.value=V.applications.filter(n=>n.deceased.district.name===P.value):L.value=V.applications};be(()=>{const n=[...new Set(V.applications.map(l=>l.deceased.district.name))];B.value=n.map(l=>({label:l,value:l}))});const w=z(()=>{let n=V.applications;return p.value==="Incoming"?n=n.filter(l=>l.status==="Pending"):p.value==="Approved"?n=n.filter(l=>l.status==="Approved"):p.value==="Rejected"&&(n=n.filter(l=>l.status==="Rejected")),h.value&&(n=n.filter(l=>l.application_no.toString().includes(h.value)||l.deceased.name.toLowerCase().includes(h.value.toLowerCase()))),n}),M=n=>{p.value=n},ne=n=>{T.get(route("applications.show",n))},oe=async()=>{if(i.value.length>0)try{await T.post("/admin/applications/approve-all",{ids:i.value},{onSuccess:()=>{i.value=[]}})}catch(n){console.error("Error approving applications:",n)}},de=async()=>{if(i.value.length>0)try{await T.post("/admin/applications/reject-all",{ids:i.value},{onSuccess:()=>{i.value=[]}})}catch(n){console.error("Error rejecting applications:",n)}},ue=()=>{const n=document.querySelector(".table-responsive").innerHTML,l=window.open("","","width=800,height=600");l.document.write(`
        <html>
            <head>
                <title>Print Table</title>
                <style>
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        padding: 8px 12px;
                        text-align: left;
                        border-bottom: 1px solid #ddd;
                    }
                    th {
                        background-color: #3A424A;
                        color: white;
                        font-weight: bold;
                    }
                </style>
            </head>
            <body>${n}</body>
        </html>
    `),l.document.close(),l.print()},ie=()=>{const n=w.value.map(e=>{var U,S,F,D,I,j,Q;return{"Applicant ID":e==null?void 0:e.application_no,"Deceased Name":(U=e==null?void 0:e.deceased)==null?void 0:U.name,"Deceased District":(F=(S=e==null?void 0:e.deceased)==null?void 0:S.district)==null?void 0:F.name,Kilometer:(D=e==null?void 0:e.transport)==null?void 0:D.distance,Amount:(I=e==null?void 0:e.transport)==null?void 0:I.transport_cost,"Applicant Name":(j=e==null?void 0:e.applicant)==null?void 0:j.name,"Applicant Phone":(Q=e==null?void 0:e.applicant)==null?void 0:Q.mobile,Status:e==null?void 0:e.status,"Date Created":e==null?void 0:e.created_at}}),l=$.json_to_sheet(n),q=$.book_new();$.book_append_sheet(q,l,"Applications");const R=new Date().toISOString().slice(0,10);ce(q,`Applications_${R}.xlsx`)},re=z(()=>[{label:"Incoming",count:V.statusCounts.Incoming||0,bgClass:"bg-[#FFF7EF]",textClass:"text-[#FD7900]"},{label:"Approved",count:V.statusCounts.Approved||0,bgClass:"bg-[#EEFFF8]",textClass:"text-[#00AA68]"},{label:"Rejected",count:V.statusCounts.Rejected||0,bgClass:"bg-[#FFF2F2]",textClass:"text-[#FE6262]"},{label:"Pending",count:V.statusCounts.Pending||0,bgClass:"bg-[#F2F8FF]",textClass:"text-[#404CF1]"},{label:"Paid",count:V.statusCounts.Paid||0,bgClass:"bg-[#F2FBFF]",textClass:"text-[#00AEFF]"}]),me=n=>{confirm("Are you sure you want to delete this application?")&&T.delete(`/applications/${n}`,{onSuccess:()=>{}})};return(n,l)=>(u(),y(Ce,{padding:""},{default:o(()=>{var q,R;return[(q=v.flash)!=null&&q.success?(u(),y(K,{key:0,class:"bg-green-4 text-white",dense:""},{default:o(()=>[N(m(v.flash.success),1)]),_:1})):f("",!0),(R=v.flash)!=null&&R.error?(u(),y(K,{key:1,class:"bg-red-4 text-white",dense:""},{default:o(()=>[N(m(v.flash.error),1)]),_:1})):f("",!0),a("div",Ue,[(u(!0),g(J,null,Y(re.value,e=>(u(),g("div",{key:e.label,class:k(`w-full h-[78px] ${e.bgClass} ${e.textClass} text-center`)},[a("h6",Se,m(e.count),1),a("p",Fe,m(e.label),1)],2))),128))]),a("div",De,[a("div",Ie,[t(r,{label:"All",flat:"",class:k(p.value==="All"?"active-button":"inactive-button"),onClick:l[0]||(l[0]=e=>M("All"))},null,8,["class"]),t(r,{label:"Incoming",flat:"",class:k(p.value==="Incoming"?"active-button":"inactive-button"),onClick:l[1]||(l[1]=e=>M("Incoming"))},null,8,["class"]),t(r,{label:"Approved",flat:"",class:k(p.value==="Approved"?"active-button":"inactive-button"),onClick:l[2]||(l[2]=e=>M("Approved"))},null,8,["class"]),t(r,{label:"Rejected",flat:"",class:k(p.value==="Rejected"?"active-button":"inactive-button"),onClick:l[3]||(l[3]=e=>M("Rejected"))},null,8,["class"])]),a("div",je,[t(d,{rounded:"lg",outlined:"",dense:"","bottom-slots":"",modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=e=>h.value=e),label:"Search",class:"w-full max-w-md"},{append:o(()=>[h.value!==""?(u(),y(x,{key:0,name:"close",onClick:l[4]||(l[4]=e=>h.value=""),class:"cursor-pointer"})):f("",!0),t(x,{name:"search"})]),_:1},8,["modelValue"])])]),a("div",Qe,[a("div",Ne,[te.value?(u(),g("div",Te,[t(r,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:se},{default:o(()=>[t(x,{name:"check",size:"16px",class:"q-mr-xs"}),l[33]||(l[33]=a("span",null,"Select All",-1))]),_:1}),t(r,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:oe,disabled:!i.value.length},{default:o(()=>[t(x,{name:"check_circle",size:"16px",class:"q-mr-xs"}),l[34]||(l[34]=a("span",null,"Approve All",-1))]),_:1},8,["disabled"]),t(r,{style:{"border-radius":"8px"},size:"md",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center hover:bg-[#3A424A] hover:text-white",onClick:de,disabled:!i.value.length},{default:o(()=>[t(x,{name:"cancel",size:"16px",class:"q-mr-xs"}),l[35]||(l[35]=a("span",null,"Reject All",-1))]),_:1},8,["disabled"])])):f("",!0)]),a("div",Ee,[t(r,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","border-radius":"8px"},onClick:ue},{default:o(()=>[t(x,{name:"print",size:"16px",class:"q-mr-xs"}),l[36]||(l[36]=a("span",null,"Print",-1))]),_:1}),t(r,{size:"sm",flat:"",outlined:"",class:"q-btn-custom flex items-center justify-center",style:{color:"#000",width:"100px",height:"40px","border-radius":"8px"},onClick:ie},{default:o(()=>[t(x,{name:"ios_share",size:"16px",class:"q-mr-xs"}),l[37]||(l[37]=a("span",null,"Export",-1))]),_:1}),t(A,{style:{color:"#000",width:"160px",height:"40px","flex-shrink":"0","border-radius":"8px",border:"1px solid black",background:"transparent"},modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=e=>P.value=e),options:B.value,label:"Select District",outlined:"",dense:"",class:"q-mb-md",onInput:ae},null,8,["modelValue","options"])])]),a("div",Pe,[a("table",Me,[l[42]||(l[42]=a("thead",null,[a("tr",{class:"bg-[#3A424A] text-white"},[a("th"),a("th",null,"APPLICANT ID"),a("th",null,"MITTHI HMING"),a("th",null,"MITTHI KHUA"),a("th",null,"KILOMETER"),a("th",null,"AMOUNT"),a("th",null,"DIL SAKTU"),a("th",null,"DILTU PHONE NO"),a("th",null,"STATUS"),a("th",null,"DIL NI"),a("th",null,"ACTIONS")])],-1)),w.value.length?(u(),g("tbody",Re,[(u(!0),g(J,null,Y(w.value,e=>{var U,S,F,D,I,j,Q;return u(),g("tr",{key:e.id},[a("td",null,[G(a("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":l[7]||(l[7]=O=>i.value=O)},null,8,Oe),[[he,i.value]])]),a("td",null,m(e==null?void 0:e.application_no),1),a("td",null,m((U=e==null?void 0:e.deceased)==null?void 0:U.name),1),a("td",null,m((F=(S=e==null?void 0:e.deceased)==null?void 0:S.district)==null?void 0:F.name),1),a("td",null,m((D=e==null?void 0:e.transport)==null?void 0:D.distance),1),a("td",null,m((I=e==null?void 0:e.transport)==null?void 0:I.transport_cost),1),a("td",null,m((j=e==null?void 0:e.applicant)==null?void 0:j.name),1),a("td",null,m((Q=e==null?void 0:e.applicant)==null?void 0:Q.mobile),1),a("td",null,[a("div",{class:k([{"status-incoming":(e==null?void 0:e.status)==="Pending","status-approved":(e==null?void 0:e.status)==="Approved","status-paid":(e==null?void 0:e.status)==="Paid","status-rejected":(e==null?void 0:e.status)==="Rejected"},"status-badge"])},m(e==null?void 0:e.status),3)]),a("td",null,m(W(e==null?void 0:e.created_at)),1),a("td",null,[t(r,{flat:"",icon:"more_vert"}),t(ke,null,{default:o(()=>[t(ye,null,{default:o(()=>[t(_,{clickable:"",class:"action-btn",onClick:O=>ne(e.id)},{default:o(()=>[t(C,{avatar:""},{default:o(()=>[t(x,{size:"sm",name:"visibility"})]),_:1}),t(C,null,{default:o(()=>l[38]||(l[38]=[N("View")])),_:1})]),_:2},1032,["onClick"]),t(_,{clickable:"",class:"action-btn",onClick:O=>X(e)},{default:o(()=>[t(C,{avatar:""},{default:o(()=>[t(x,{name:"edit"})]),_:1}),t(C,null,{default:o(()=>l[39]||(l[39]=[N("Edit/Update")])),_:1})]),_:2},1032,["onClick"]),t(_,{clickable:"",class:"action-btn",onClick:O=>me(e.id)},{default:o(()=>[t(C,{avatar:""},{default:o(()=>[t(x,{name:"delete"})]),_:1}),t(C,null,{default:o(()=>l[40]||(l[40]=[N("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])])}),128))])):(u(),g("tbody",$e,l[41]||(l[41]=[a("tr",null,[a("td",{colspan:"11",class:"text-center text-gray-500"}," No applications found. ")],-1)])))])],512),t(pe,{modelValue:E.value,"onUpdate:modelValue":l[32]||(l[32]=e=>E.value=e)},{default:o(()=>[t(fe,{class:"w-[411px] h-[822px] rounded-md"},{default:o(()=>[t(ge,null,{default:o(()=>[t(Ae,{onSubmit:xe(Z,["prevent"])},{default:o(()=>[c.value===1?(u(),g("div",ze,[l[43]||(l[43]=a("p",{class:"text-center w-[242px] h-[17px] flex-shrink-0 rounded-[20px] bg-[#E9E9E9] mb-8"}," Ruang Phurh MITTHI Chungchang ",-1)),t(d,{modelValue:s.value.deceased.name,"onUpdate:modelValue":l[8]||(l[8]=e=>s.value.deceased.name=e),label:"Mitthi hming",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.deceased.relative_name,"onUpdate:modelValue":l[9]||(l[9]=e=>s.value.deceased.relative_name=e),label:"A chhungte hming",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{type:"date",modelValue:s.value.deceased.dob,"onUpdate:modelValue":l[10]||(l[10]=e=>s.value.deceased.dob=e),label:"Mitthi Pianni leh thla",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(A,{modelValue:s.value.deceased.district.name,"onUpdate:modelValue":l[11]||(l[11]=e=>s.value.deceased.district.name=e),options:v.dropdowns.districts,"option-label":"name","option-value":"id",label:"District",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),t(d,{modelValue:s.value.deceased.locality,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value.deceased.locality=e),label:"Locality",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(A,{modelValue:s.value.deceased.constituency.name,"onUpdate:modelValue":l[13]||(l[13]=e=>s.value.deceased.constituency.name=e),options:v.dropdowns.constituencies,"option-label":"name","option-value":"id",label:"Constituency",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),t(d,{type:"datetime-local",modelValue:s.value.deceased.time_of_death,"onUpdate:modelValue":l[14]||(l[14]=e=>s.value.deceased.time_of_death=e),label:"Thih ni leh darkar",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.deceased.place_of_death,"onUpdate:modelValue":l[15]||(l[15]=e=>s.value.deceased.place_of_death=e),label:"Thihna hmun",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"])])):f("",!0),c.value===2?(u(),g("div",_e,[l[44]||(l[44]=a("p",{class:"text-center w-[242px] h-[17px] flex-shrink-0 rounded-[20px] bg-[#E9E9E9] mb-8"}," Ruang Phurh leh Motor Chungchang ",-1)),t(A,{modelValue:s.value.transport.source_district,"onUpdate:modelValue":l[16]||(l[16]=e=>s.value.transport.source_district=e),options:v.dropdowns.districts,"option-label":"name","option-value":"id",label:"Ruang phurh tanna tur District awmna",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),t(d,{modelValue:s.value.transport.source_locality,"onUpdate:modelValue":l[17]||(l[17]=e=>s.value.transport.source_locality=e),label:"Ruang chhuah veng/khua thlanna",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(A,{modelValue:s.value.transport.destination_district,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.transport.destination_district=e),options:v.dropdowns.districts,"option-label":"name","option-value":"id",label:"Ruang zalhna tur District awmna",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),t(d,{modelValue:s.value.transport.destination_locality,"onUpdate:modelValue":l[19]||(l[19]=e=>s.value.transport.destination_locality=e),label:"Ruang zalhna veng/khua thlanna",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.transport.distance,"onUpdate:modelValue":l[20]||(l[20]=e=>s.value.transport.distance=e),label:"Distance (Km)",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.transport.transport_cost,"onUpdate:modelValue":l[21]||(l[21]=e=>s.value.transport.transport_cost=e),label:"Transport Cost",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.transport.vehicle_number,"onUpdate:modelValue":l[22]||(l[22]=e=>s.value.transport.vehicle_number=e),label:"Vehicle Number",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.transport.driver_name,"onUpdate:modelValue":l[23]||(l[23]=e=>s.value.transport.driver_name=e),label:"Driver Name",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.transport.driver_phone,"onUpdate:modelValue":l[24]||(l[24]=e=>s.value.transport.driver_phone=e),label:"Driver Phone",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"])])):f("",!0),c.value===3?(u(),g("div",Le,[t(d,{modelValue:s.value.applicant.name,"onUpdate:modelValue":l[25]||(l[25]=e=>s.value.applicant.name=e),label:"Applicant Name",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.applicant.mobile,"onUpdate:modelValue":l[26]||(l[26]=e=>s.value.applicant.mobile=e),label:"Mobile",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(A,{modelValue:s.value.applicant.district.name,"onUpdate:modelValue":l[27]||(l[27]=e=>s.value.applicant.district.name=e),options:v.dropdowns.districts,"option-label":"name","option-value":"id",label:"Ruang phurhna man diltu district",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),t(d,{modelValue:s.value.applicant.locality,"onUpdate:modelValue":l[28]||(l[28]=e=>s.value.applicant.locality=e),label:"Ruang phurhna man diltu veng/khua",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.applicant.bank_name,"onUpdate:modelValue":l[29]||(l[29]=e=>s.value.applicant.bank_name=e),label:"Bank hming",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.applicant.account_no,"onUpdate:modelValue":l[30]||(l[30]=e=>s.value.applicant.account_no=e),label:"Account No",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(d,{modelValue:s.value.applicant.ifsc_code,"onUpdate:modelValue":l[31]||(l[31]=e=>s.value.applicant.ifsc_code=e),label:"IFSC Code",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"])])):f("",!0),t(Ve,{align:"right"},{default:o(()=>[G(t(r,{class:"text-black",color:"white",label:"Cancel"},null,512),[[we]]),c.value>1?(u(),y(r,{key:0,label:"Previous",color:"grey",onClick:le})):f("",!0),c.value<3?(u(),y(r,{key:1,label:"Next",color:"black",onClick:ee})):f("",!0),c.value===3?(u(),y(r,{key:2,label:"Submit",color:"black",type:"submit"})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}});export{nl as default};
